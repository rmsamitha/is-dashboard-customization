<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<ModulePrefs title="Applications">
    <Require feature="pubsub-2"/>
</ModulePrefs>
<Content type="html" view="default">
    <![CDATA[

    <link rel="stylesheet" type="text/css" href="js/ui/css/main.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-missing.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/dialog.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/smoothness/jquery-ui-1.10.3.custom.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/smoothness/jqueryui-themeroller.css">

    <script type="text/javascript" src="js/jquery.min.js"></script>
    <script type="text/javascript" src="serverinfo.jag"></script>
    <script>
        var headID = document.getElementsByTagName("head")[0];
        var cssNode = document.createElement('link');
        cssNode.type = 'text/css';
        cssNode.rel = 'stylesheet';
        cssNode.href = PROXY_CONTEXT_PATH + '/portal/gadgets/applications/js/ui/font-awesome/css/font-awesome.min.css';
        headID.appendChild(cssNode);
    </script>
    <script>
        $(function () {
            $('.max_view').click(function () {
                gadgets.Hub.publish('org.wso2.is.dashboard', {
                    msg: 'A message from My profile',
                    id: "applications  .expand-widget"
                });
            });
        });
    </script>

    <div class='icon-user icon-user-dashboard icon-marketing-styles'></div>
    Applications accessible to you.
    <p><a class='btn btn-default max_view' href=''>View details</a></p>
    ]]>
</Content>

<Content type="html" view="home">
    <![CDATA[
    <script type="text/javascript" src="js/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/jquery.min.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/main.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/modal.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/gadget.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/qrCodeGenerator.js" type="text/javascript"></script>
    <script type="text/javascript" src="js/u2f-api.js" type="text/javascript"></script>
    <script type="text/javascript" src="serverinfo.jag"></script>

    <script type="text/javascript" src="../wso2-dev/js/jquery.numberformatter-1.2.3.js" type="text/javascript"></script>
    <script type="text/javascript" src="../wso2-dev/js/jquery.dependClass-0.1.js" type="text/javascript"></script>
    <script type="text/javascript" src="../wso2-dev/js/jquery.slider.js" type="text/javascript"></script>
    <script type="text/javascript" src="../../themes/portal/js/UESContainer.js"></script>

    <link rel="stylesheet" type="text/css" href="js/ui/css/main.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-theme.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-missing.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/bootstrap-theme.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/dialog.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/smoothness/jquery-ui-1.10.3.custom.min.css">
    <link rel="stylesheet" type="text/css" href="js/ui/css/smoothness/jqueryui-themeroller.css">
    <script type="text/javascript">
    var userName;
       /*
        $(function WindowLoad(event) {
                alert("ffffffffffffff");
                var obj = $.parseJSON(event.data);
               // cookie = obj.cookie;
                userName = obj.user;

        }

        alert(userName);
        var link = document.createElement('link');

        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = 'css1.css';

        document.head.appendChild(link); */
    </script>
    <!--link rel="stylesheet" type="text/css" href="js/ui/css/uva/test.css"-->

    <script>
        var headID = document.getElementsByTagName("head")[0];
        var cssNode = document.createElement('link');
        cssNode.type = 'text/css';
        cssNode.rel = 'stylesheet';
        cssNode.href = PROXY_CONTEXT_PATH + '/portal/gadgets/applications/js/ui/font-awesome/css/font-awesome.min.css';
        headID.appendChild(cssNode);
    </script>

    <script type="text/javascript">
        var cookie = null;
        var json = null;
        var userName = null;
        var serverUrl = window.location.host + PROXY_CONTEXT_PATH;

        $(function WindowLoad(event) {
            url = 'wss://' + serverUrl + '/dashboard/session_manager.jag';
            ws = new WebSocket(url);

            ws.onopen = function () {
                console.log("web Socket onopen. ");
                ws.send("First Message open");
            };
            ws.onmessage = function (event) {
                var obj = $.parseJSON(event.data);
                cookie = obj.cookie;
                userName = obj.user;
                if (cookie != null) {
                    var str = PROXY_CONTEXT_PATH + "/portal/gadgets/applications/index.jag?cookie=" + cookie + "&user=" + userName;

                    $.ajax({
                        type: "GET",
                        url: str

                    })
                            .done(function (data) {
                                json = $.parseJSON(data);
                                drawPage();

                            })
                            .fail(function () {
                                console.log('error');

                            })
                            .always(function () {
                                console.log('completed');
                            });
                }

                //add relevant css style sheets
                var userTenant = userName.substring(userName.lastIndexOf("@") + 1);
                loadRelevantCSS(userTenant);
            };
            ws.onclose = function () {
                console.log("web Socket onclose. ");
            };
        });

        function loadRelevantCSS(userTenant) {
                var headID = document.getElementsByTagName("head")[0];
                var cssNode = document.createElement('link');
                cssNode.type = 'text/css';
                cssNode.rel = 'stylesheet';
                cssNode.href = PROXY_CONTEXT_PATH + '/portal/gadgets/applications/js/ui/css/'+userTenant+'/test.css';
                headID.appendChild(cssNode);
        }

        //fido client code
        var request;
        var loggedInUser;





    </script>


    <form id="gadgetForm" class="form-horizontal">
        <div id="gadgetBody" style="text-align: center;width: 40%;margin: auto;"></div>
        <div id="message"></div>
    </form>
    <form id="fidoForm">
        <div id="message"></div>
        <input type="hidden" id="tokenResponse" name="tokenResponse" value=""/>
    </form>

    ]]>
</Content>
</Module>
